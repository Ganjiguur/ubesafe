//source: https://dev.vizuina.com/cropper/
var Cropper=function(){function a(a,b){return a.currentStyle?a.currentStyle[b]:"function"==typeof window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue(b):a.style[b]}function b(a){return a=a||window.event,a.target=a.target||a.srcElement,a.relatedTarget=a.relatedTarget||("mouseover"==a.type?a.fromElement:a.toElement),a.target=a.target||a.srcElement,a.stop=function(){a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),null!=a.cancelBubble&&(a.cancelBubble=!0)},3===a.target.nodeType&&(a.target=a.target.parentNode),a}function c(a){if(null===a||"object"!=typeof a)return a;var b=a.constructor();for(var d in a)b[d]=c(a[d]);return b}var d={container_class:"cropper",width:0,height:0,min_width:0,min_height:0,max_width:0,max_height:0,ratio:{width:0,height:0}};Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Bound function not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var e=function(){return window.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:window.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(a,b,c){a["on"+b]=c}}(),f=function(a,b){this.options=c(d),b=b||{};for(var e in b)this.options[e]=b[e];this.image=a;var f=this.image.getBoundingClientRect();this.width=Math.round(f.right-f.left),this.height=Math.round(f.bottom-f.top),this.coordinates={x:0,y:0,width:0,height:0},this.moving=this.resizing=this.direction=!1,this.handles={},this.overlays={},this.wrapImage(),this.attachEventListeners()};return f.prototype.wrapImage=function(){var b=document.createElement("div");b.className=this.options.container_class;var c=this.image.parentNode,d=this.image.nextSibling;b.appendChild(this.image),this.image.style.padding=this.image.style.margin=this.image.style.border=0,d?c.insertBefore(b,d):c.appendChild(b),this.image.ondragstart=function(){return!1};var e=a(b,"position");"static"==e&&(b.style.position="relative"),b.style.width=this.width+"px",b.style.height=this.height+"px",this.container=b},f.prototype.createCropArea=function(a){var b=document.createElement("div");b.className=this.options.container_class+"-area",b.style.position="absolute",b.style.cursor="move",b.style.background="url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)",this.createHandles(b),this.createOverlays(b),this.container.appendChild(b),this.crop_area=b},f.prototype.createHandles=function(a){if(!this.options.static){var c=this,d="-3px",f={nw:{left:d,top:d},n:{left:"50%",top:d,marginLeft:d},ne:{right:d,top:d},e:{right:d,top:"50%",marginTop:d},se:{right:d,bottom:d,zIndex:10},s:{left:"50%",bottom:d,marginLeft:d},sw:{left:d,bottom:d},w:{left:d,top:"50%",marginTop:d}};for(var g in f){var h=f[g],i=document.createElement("div");i.className=this.options.container_class+"-area-handle";for(var j in h)i.style[j]=h[j];i.style.position="absolute",i.style.cursor=g+"-resize",i.setAttribute("position",g),a.appendChild(i),e(i,"mousedown",function(a){c.resizing=!0,c.direction=b(a).target.getAttribute("position")}),this.handles[g]=i}}},f.prototype.createOverlays=function(){var a={top:{left:0,top:0,right:0,width:"100%"},left:{left:0},right:{right:0},bottom:{left:0,bottom:0,right:0,width:"100%"}};for(position in a){var b=a[position],c=document.createElement("div");c.className=this.options.container_class+"-overlay",c.style.position="absolute";for(var d in b)c.style[d]=b[d];this.container.appendChild(c),this.overlays[position]=c}},f.prototype.draw=function(a){this.crop_area||this.createCropArea({x:a.x,y:a.y}),this.coordinates=a,this.crop()},f.prototype.attachEventListeners=function(){e(this.container,"mousedown",this.mouseDown.bind(this)),e(document,"mouseup",this.mouseUp.bind(this)),e(document,"mousemove",this.mouseMove.bind(this))},f.prototype.mouseDown=function(a){b(a).stop();var d=b(a).target,e=this.getCursorPosition(a);if(this.crop_area||this.createCropArea(e),this.dragStartCrop=c(this.coordinates),this.dragStart=e,d==this.crop_area)return void(this.moving=!0);if(d.className!=this.options.container_class+"-area-handle"){var f=this.options.width?this.options.width:this.options.min_width?this.options.min_width:0,g=this.options.height?this.options.height:this.options.min_height?this.options.min_height:0;this.coordinates.x=e.x,this.coordinates.y=e.y,this.coordinates.width=f,this.coordinates.height=g,this.dragStartCrop=c(this.coordinates),this.crop(),f&&g||(this.resizing=!0,this.direction="se")}},f.prototype.crop=function(){this.confine(),this.crop_area.style.left=this.coordinates.x+"px",this.crop_area.style.top=this.coordinates.y+"px",this.crop_area.style.width=this.coordinates.width+"px",this.crop_area.style.height=this.coordinates.height+"px",this.overlays.top.style.height=this.overlays.left.style.top=this.overlays.right.style.top=this.coordinates.y+"px",this.overlays.left.style.height=this.overlays.right.style.height=this.coordinates.height+"px",this.overlays.left.style.width=this.coordinates.x+"px",this.overlays.right.style.width=this.width-this.coordinates.x-this.coordinates.width+"px",this.overlays.bottom.style.height=this.height-this.coordinates.y-this.coordinates.height+"px","function"==typeof this.options.update&&this.options.update.call(this,this.coordinates)},f.prototype.confine=function(){this.coordinates.x+this.coordinates.width>this.width&&(this.coordinates.x=this.width-this.coordinates.width),this.coordinates.x<0&&(this.coordinates.x=0),this.coordinates.y+this.coordinates.height>this.height&&(this.coordinates.y=this.height-this.coordinates.height),this.coordinates.y<0&&(this.coordinates.y=0)},f.prototype.mouseUp=function(a){this.resizing=this.moving=this.direction=!1},f.prototype.mouseMove=function(a){return this.resizing?this.resize(a):this.moving?this.move(a):void 0},f.prototype.resize=function(a){function b(){this.direction.match(/w/)?(e=d.x,g-=delta_x,d.x>this.dragStartCrop.x+this.dragStartCrop.width&&(this.direction=this.direction.replace("w","e"),e=this.dragStartCrop.x+this.dragStartCrop.width,this.dragStart.x=this.dragStartCrop.x=e,this.dragStartCrop.width=g=0)):this.direction.match(/e/)&&(g=Math.min(g+delta_x,this.width-e),d.x<this.dragStartCrop.x&&(this.direction=this.direction.replace("e","w"),this.dragStart.x=e,this.dragStartCrop.width=g=0))}function c(a){this.direction.match(/n/)?(a?(h=Math.round(g/a),f=this.dragStartCrop.y+this.dragStartCrop.height-h):(f=d.y,h-=delta_y),d.y>this.dragStartCrop.y+this.dragStartCrop.height&&(this.direction=this.direction.replace("n","s"),f=this.dragStart.y+this.dragStartCrop.height,this.dragStart.y=this.dragStartCrop.y=f,this.dragStartCrop.height=h=0)):this.direction.match(/s/)&&(h=a?Math.round(g/a):Math.min(h+delta_y,this.height-f),d.y<this.dragStartCrop.y&&(this.direction=this.direction.replace("s","n"),this.dragStart.y=f,this.dragStartCrop.height=h=0))}var d=this.getCursorPosition(a),e=this.dragStartCrop.x,f=this.dragStartCrop.y,g=this.dragStartCrop.width,h=this.dragStartCrop.height;if(d.x=Math.max(0,d.x),d.y=Math.max(0,d.y),delta_x=d.x-this.dragStart.x,delta_y=d.y-this.dragStart.y,this.options.ratio.width>0&&this.options.ratio.height>0){var i=this.options.ratio.width/this.options.ratio.height;"n"==this.direction||"s"==this.direction?(c.call(this),g=h*i):"w"==this.direction||"e"==this.direction?(b.call(this),h=g/i):(b.call(this),c.call(this,i))}else b.call(this),c.call(this);this.options.min_width&&(g=Math.max(g,this.options.min_width)),this.options.min_height&&(h=Math.max(h,this.options.min_height)),this.options.max_width&&(g=Math.min(g,this.options.max_width)),this.options.max_height&&(h=Math.min(h,this.options.max_height)),this.coordinates.x=Math.round(e),this.coordinates.y=Math.round(f),this.coordinates.width=Math.round(g),this.coordinates.height=Math.round(h),this.crop()},f.prototype.move=function(a){var b=this.getCursorPosition(a),c=b.x-this.dragStart.x,d=b.y-this.dragStart.y;this.coordinates.x=this.dragStartCrop.x+c,this.coordinates.y=this.dragStartCrop.y+d,this.crop()},f.prototype.getCursorPosition=function(a){var c=this.container.getBoundingClientRect();return a=b(a),{x:Math.round(a.clientX-c.left),y:Math.round(a.clientY-c.top)}},f}();